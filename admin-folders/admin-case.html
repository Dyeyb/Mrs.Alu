<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Studies ‚Äì Mrs. Alu Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        :root{
            --gold:#c9a561;--dark:#1a1a1a;--text:#2d2d2d;
            --border:#e5e0d8;--bg:#f4f1eb;--hover:#f8f5f0;
            --shadow:0 4px 20px rgba(0,0,0,.08);--ease:all .3s cubic-bezier(.4,0,.2,1);
            --sw:270px;--sc:68px;--th:64px;--accent:#c9a561;--brown:#2d1a08;
        }
        body{font-family:'Outfit',sans-serif;background:var(--bg);min-height:100vh;color:var(--text);display:flex;font-size:14px;}

        /* SIDEBAR */
        .sidebar{width:var(--sw);min-height:100vh;display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:200;transition:width .3s ease;overflow:hidden;}
        .sidebar.col{width:var(--sc);}
        .sb-bg{position:absolute;inset:0;background:url('https://images.unsplash.com/photo-1486325212027-8081e485255e?w=600&q=80&fit=crop') center/cover;filter:brightness(.55) saturate(.6) sepia(.3);transition:transform .6s ease;}
        .sidebar:hover .sb-bg{transform:scale(1.03);}
        .sb-ov{position:absolute;inset:0;background:linear-gradient(180deg,rgba(30,15,5,.95) 0%,rgba(70,42,18,.6) 50%,rgba(25,12,3,.95) 100%);pointer-events:none;}
        .sidebar>*:not(.sb-bg):not(.sb-ov){position:relative;z-index:1;}
        .sb-logo{height:var(--th);padding:0 18px;display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(201,165,97,.18);text-decoration:none;flex-shrink:0;}
        .sb-icon{width:36px;height:36px;flex-shrink:0;background:linear-gradient(135deg,rgba(60,35,12,.9),var(--accent));border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:700;color:#fff;border:1px solid rgba(201,165,97,.4);}
        .sb-text{overflow:hidden;white-space:nowrap;}
        .sb-name{font-family:'Cormorant Garamond',serif;font-size:19px;font-weight:600;color:#fff;line-height:1;}
        .sb-name span{color:var(--accent);font-style:italic;}
        .sb-sub{font-size:10px;color:rgba(255,255,255,.38);letter-spacing:2px;text-transform:uppercase;margin-top:2px;}
        .sidebar.col .sb-text,.sidebar.col .sb-uinfo{display:none;}
        .sidebar.col .sb-logo,.sidebar.col .sb-user{justify-content:center;gap:0;}
        .sb-nav{flex:1;padding:10px 0;overflow-y:auto;overflow-x:hidden;}
        .sb-nav::-webkit-scrollbar{width:2px;}
        .sb-nav::-webkit-scrollbar-thumb{background:rgba(201,165,97,.2);}
        .sb-sec{font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:rgba(201,165,97,.42);padding:12px 18px 5px;white-space:nowrap;}
        .sidebar.col .sb-sec{opacity:0;height:0;padding:0;}
        .na{display:flex;align-items:center;gap:10px;padding:9px 18px;text-decoration:none;color:rgba(255,255,255,.56);font-size:13px;font-weight:500;position:relative;transition:var(--ease);white-space:nowrap;}
        .na::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:transparent;transition:var(--ease);}
        .na:hover{color:rgba(255,255,255,.95);background:rgba(201,165,97,.1);}
        .na:hover::before{background:rgba(201,165,97,.4);}
        .na.act{color:var(--accent);background:rgba(201,165,97,.13);}
        .na.act::before{background:var(--accent);}
        .na svg{width:16px;height:16px;flex-shrink:0;}
        .sidebar.col .nl{opacity:0;width:0;overflow:hidden;}
        .sidebar.col .na{justify-content:center;padding:11px 0;gap:0;}
        .sb-bot{padding:12px;border-top:1px solid rgba(201,165,97,.14);flex-shrink:0;}
        .sb-user{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;border:1px solid rgba(201,165,97,.16);background:rgba(0,0,0,.22);cursor:pointer;transition:var(--ease);}
        .sb-user:hover{background:rgba(201,165,97,.1);border-color:rgba(201,165,97,.3);}
        .sb-av{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--brown),var(--accent));display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;flex-shrink:0;border:1.5px solid rgba(201,165,97,.38);}
        .sb-uname{font-size:12px;font-weight:600;color:#fff;white-space:nowrap;}
        .sb-urole{font-size:10px;color:rgba(255,255,255,.35);white-space:nowrap;}
        .col-btn{width:100%;background:none;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;color:rgba(255,255,255,.26);font-size:11px;font-family:'Outfit',sans-serif;padding:8px 0 0;transition:var(--ease);}
        .col-btn:hover{color:var(--accent);}
        .col-btn svg{width:14px;height:14px;transition:transform .3s;}
        .sidebar.col .col-btn svg{transform:rotate(180deg);}
        .sidebar.col .col-btn span{display:none;}

        /* MAIN */
        .main{margin-left:var(--sw);flex:1;min-height:100vh;display:flex;flex-direction:column;transition:margin-left .3s ease;}
        .main.col{margin-left:var(--sc);}

       /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        .main { margin-left: var(--sidebar-w); flex: 1; transition: margin-left 0.3s cubic-bezier(0.4,0,0.2,1); min-height: 100vh; display: flex; flex-direction: column; }
        .main.collapsed { margin-left: var(--sidebar-collapsed); }
        .topbar { position: sticky; top: 0; z-index: 50; height: 70px; padding: 0 36px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(201,165,97,0.2); box-shadow: 0 4px 28px rgba(28,14,4,0.45); overflow: hidden; }
        .topbar::before { content: ''; position: absolute; inset: 0; background-image: url('https://images.unsplash.com/photo-1486325212027-8081e485255e?w=1400&q=85&fit=crop&crop=top'); background-size: cover; background-position: center 20%; filter: brightness(0.55) saturate(0.65) sepia(0.35); pointer-events: none; z-index: 0; }
        .topbar::after { content: ''; position: absolute; inset: 0; background: linear-gradient(105deg,rgba(28,14,4,0.95) 0%,rgba(74,46,24,0.82) 30%,rgba(107,66,38,0.60) 60%,rgba(74,46,24,0.80) 82%,rgba(28,14,4,0.94) 100%); pointer-events: none; z-index: 1; }
        .topbar-left { display: flex; align-items: center; gap: 16px; position: relative; z-index: 2; }
        .topbar-title { font-family: 'Cormorant Garamond',serif; font-size: 22px; font-weight: 600; color: #fff; }
        .topbar-title span { color: var(--primary-accent); font-style: italic; }
        .breadcrumb-bar { display: flex; align-items: center; gap: 6px; font-size: 13px; color: rgba(255,255,255,0.5); }
        .breadcrumb-bar span { color: rgba(201,165,97,0.85); font-weight: 500; }
        .breadcrumb-bar .sep { color: rgba(255,255,255,0.25); }
        .topbar-right { display: flex; align-items: center; gap: 12px; position: relative; z-index: 2; }
        .topbar-btn { width: 38px; height: 38px; border-radius: 10px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.15); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); position: relative; color: rgba(255,255,255,0.8); }
        .topbar-btn:hover { background: rgba(255,255,255,0.18); border-color: var(--primary-accent); color: var(--primary-accent); }
        .topbar-btn svg { width: 18px; height: 18px; }
        .notif-dot { position: absolute; top: 7px; right: 7px; width: 7px; height: 7px; border-radius: 50%; background: var(--primary-accent); border: 2px solid var(--brown); }
        .topbar-avatar { width: 38px; height: 38px; border-radius: 50%; background: linear-gradient(135deg,var(--brown-dark),var(--primary-accent)); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: #fff; cursor: pointer; transition: var(--transition); border: 2px solid rgba(201,165,97,0.4); }
        .topbar-avatar:hover { border-color: var(--primary-accent); transform: scale(1.05); }

        /* DROPDOWNS */
        .drop{
            position:absolute;top:calc(100% + 8px);right:0;
            background:#fff;border:1px solid var(--border);
            border-radius:12px;box-shadow:0 10px 32px rgba(0,0,0,.13);
            z-index:400;display:none;overflow:hidden;
        }
        .drop.open{display:block;animation:fadeUp .15s ease-out;}
        .drop-notif{width:300px;}
        .drop-prof{width:210px;}

        /* Notification dropdown */
        .dh{display:flex;align-items:center;justify-content:space-between;padding:11px 14px;border-bottom:1px solid var(--border);}
        .dh-title{font-size:12px;font-weight:700;color:var(--dark);}
        .dh-clear{font-size:11px;color:var(--gold);cursor:pointer;font-weight:600;}
        .dh-clear:hover{text-decoration:underline;}
        .nl{max-height:280px;overflow-y:auto;}
        .ni{display:flex;align-items:flex-start;gap:10px;padding:10px 14px;border-bottom:1px solid #f8f5f0;cursor:pointer;transition:background .1s;}
        .ni:hover{background:var(--hover);}
        .ni:last-child{border-bottom:none;}
        .ni-ico{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
        .ni-ico svg{width:14px;height:14px;}
        .ni-w{background:#fff7ed;} .ni-w svg{color:#ea580c;}
        .ni-d{background:#fef2f2;} .ni-d svg{color:#dc2626;}
        .ni-i{background:#eff6ff;} .ni-i svg{color:#2563eb;}
        .ni-body{flex:1;min-width:0;}
        .ni-t{font-size:12px;font-weight:600;color:var(--dark);}
        .ni-desc{font-size:10px;color:#aaa;margin-top:1px;line-height:1.4;}
        .ni-time{font-size:9px;color:#ccc;margin-top:2px;}
        .nl-empty{padding:24px 14px;text-align:center;color:#ccc;font-size:12px;}

        /* Profile dropdown */
        .pt{padding:13px 14px 11px;border-bottom:1px solid var(--border);background:linear-gradient(135deg,#fefcf8,#f8f3eb);}
        .pt-name{font-size:13px;font-weight:700;color:var(--dark);}
        .pt-role{font-size:10px;color:#aaa;margin-top:1px;}
        .pt-email{font-size:10px;color:var(--gold);margin-top:2px;}

        /* Profile menu items ‚Äî FIXED: proper anchor tags for navigation */
        .pm{
            display:flex;align-items:center;gap:10px;
            padding:10px 14px;font-size:13px;color:var(--text);
            cursor:pointer;transition:background .15s;
            border:none;background:none;width:100%;
            font-family:'Outfit',sans-serif;text-align:left;
            text-decoration:none;font-weight:500;
        }
        .pm:hover{background:var(--hover);color:var(--dark);}
        .pm svg{width:15px;height:15px;color:#bbb;flex-shrink:0;transition:color .15s;}
        .pm:hover svg{color:var(--gold);}
        .pm-div{height:1px;background:var(--border);margin:3px 0;}
        .pm.out{color:#dc2626;}
        .pm.out svg{color:#fca5a5;}
        .pm.out:hover{background:#fef2f2;color:#b91c1c;}
        .pm.out:hover svg{color:#dc2626;}

        /* FLASH */
        .flash{margin:14px 24px 0;padding:10px 14px;border-radius:8px;font-size:12px;display:flex;align-items:center;gap:8px;}
        .flash-success{background:#f0fdf4;border:1px solid #bbf7d0;color:#166534;}
        .flash-error{background:#fef2f2;border:1px solid #fecaca;color:#dc2626;}
        .flash svg{width:14px;height:14px;flex-shrink:0;}
        .flash-x{margin-left:auto;cursor:pointer;opacity:.5;font-size:16px;line-height:1;background:none;border:none;color:inherit;}

        /* BUTTONS */
        .btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:7px;font-family:'Outfit',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:var(--ease);border:none;text-decoration:none;line-height:1;white-space:nowrap;}
        .btn svg{width:13px;height:13px;flex-shrink:0;}
        .btn-sm{padding:4px 9px!important;font-size:11px!important;border-radius:5px!important;}
        .btn-sm svg{width:10px!important;height:10px!important;}
        .btn-primary{background:linear-gradient(135deg,#c9a561,#e8c97a);color:#1a0e05;box-shadow:0 2px 8px rgba(201,165,97,.28);}
        .btn-primary:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(201,165,97,.38);}
        .btn-secondary{background:#f0ebe0;color:var(--text);border:1px solid var(--border);}
        .btn-secondary:hover{background:#e5ddd0;border-color:var(--gold);}
        .btn-edit{background:#eff6ff;color:#2563eb;border:1px solid #bfdbfe;}
        .btn-edit:hover{background:#dbeafe;}
        .btn-danger{background:#fef2f2;color:#dc2626;border:1px solid #fecaca;}
        .btn-danger:hover{background:#fee2e2;}

        /* TAGS */
        .tag{display:inline-flex;align-items:center;padding:2px 7px;border-radius:20px;font-size:10px;font-weight:600;}
        .tag-g{background:#f0fdf4;color:#166534;border:1px solid #bbf7d0;}
        .tag-b{background:#eff6ff;color:#2563eb;border:1px solid #bfdbfe;}

        /* MODAL */
        .mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(3px);z-index:500;align-items:center;justify-content:center;}
        .mo.open{display:flex;}
        .modal{background:#fff;border-radius:13px;width:90%;max-width:490px;box-shadow:0 18px 50px rgba(0,0,0,.17);overflow:hidden;animation:fadeUp .22s ease-out;}
        .modal-sm{max-width:380px;}
        .mh{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border);background:#fefcf8;}
        .mt{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:600;color:var(--dark);}
        .mt span{color:var(--gold);font-style:italic;}
        .mx{width:26px;height:26px;border-radius:50%;border:1px solid var(--border);background:var(--hover);display:flex;align-items:center;justify-content:center;cursor:pointer;color:#888;font-size:16px;line-height:1;transition:var(--ease);}
        .mx:hover{border-color:#dc2626;color:#dc2626;background:#fef2f2;}
        .mb{padding:18px 20px;}
        .mf{display:flex;align-items:center;justify-content:flex-end;gap:8px;padding:12px 20px;border-top:1px solid var(--border);background:#fafaf8;}

        /* FORM */
        .fg{display:grid;grid-template-columns:1fr 1fr;gap:13px;}
        .fi{display:flex;flex-direction:column;gap:4px;}
        .fi.full{grid-column:1/-1;}
        .fl{font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#999;}
        .fin,.fsel,.fta{padding:8px 11px;border:1px solid var(--border);border-radius:7px;font-family:'Outfit',sans-serif;font-size:12px;background:#fafaf8;color:var(--text);outline:none;transition:var(--ease);}
        .fin:focus,.fsel:focus,.fta:focus{border-color:var(--gold);background:#fff;box-shadow:0 0 0 3px rgba(201,165,97,.1);}
        .fta{resize:vertical;min-height:72px;}
        .ferr{display:none;grid-column:1/-1;background:#fef2f2;border:1px solid #fecaca;padding:7px 11px;border-radius:6px;font-size:11px;color:#dc2626;}

        /* STATS */
        .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:22px;}
        .sc{background:#fff;border:1px solid var(--border);border-radius:12px;padding:16px;box-shadow:var(--shadow);display:flex;align-items:flex-start;gap:12px;transition:var(--ease);}
        .sc:hover{transform:translateY(-2px);box-shadow:0 8px 26px rgba(0,0,0,.1);}
        .si{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
        .si svg{width:18px;height:18px;}
        .si-g{background:rgba(201,165,97,.13);} .si-g svg{color:var(--gold);}
        .si-b{background:#eff6ff;} .si-b svg{color:#2563eb;}
        .si-gr{background:#f0fdf4;} .si-gr svg{color:#16a34a;}
        .si-r{background:#fef2f2;} .si-r svg{color:#dc2626;}
        .sn{font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:700;color:var(--dark);line-height:1;}
        .sl{font-size:11px;color:#999;margin-top:2px;font-weight:500;}
        .sd{font-size:10px;margin-top:3px;font-weight:600;color:#16a34a;}

        /* TABLE CARD */
        .card{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;}
        .ch{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--border);}
        .ct{font-family:'Cormorant Garamond',serif;font-size:16px;font-weight:600;color:var(--dark);}
        .ct span{color:var(--gold);font-style:italic;}
        .tw{overflow-x:auto;}
        table{width:100%;border-collapse:collapse;}
        thead th{padding:9px 15px;text-align:left;font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#bbb;border-bottom:1px solid var(--border);background:#fafaf8;}
        tbody tr{transition:background .12s;}
        tbody tr:hover{background:var(--hover);}
        tbody td{padding:11px 15px;font-size:12px;color:var(--text);border-bottom:1px solid #f5f0ea;}
        tbody tr:last-child td{border-bottom:none;}
        .tn{font-weight:600;color:var(--dark);font-size:13px;}
        .ts{font-size:10px;color:#bbb;margin-top:1px;}
        .ta{display:flex;align-items:center;gap:4px;justify-content:flex-end;}

        /* CONFIRM */
        .cbd{padding:24px 20px;text-align:center;}
        .cico{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 13px;}
        .cico svg{width:24px;height:24px;}
        .ci-d{background:#fef2f2;} .ci-d svg{color:#dc2626;}
        .ctitle{font-family:'Cormorant Garamond',serif;font-size:18px;font-weight:600;color:var(--dark);margin-bottom:6px;}
        .cdesc{font-size:12px;color:#999;line-height:1.6;}
        .cname{font-weight:700;color:var(--dark);}

        /* MY PROFILE MODAL */
        .prof-modal-body{padding:0;}
        .prof-banner{height:70px;background:linear-gradient(135deg,#2d1a08,#c9a561);}
        .prof-avatar-wrap{padding:0 20px;margin-top:-24px;margin-bottom:12px;display:flex;align-items:flex-end;justify-content:space-between;}
        .prof-big-av{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#c9a561,#e8c97a);display:flex;align-items:center;justify-content:center;font-family:'Cormorant Garamond',serif;font-size:22px;font-weight:700;color:#1a0e05;border:3px solid #fff;box-shadow:0 2px 10px rgba(0,0,0,.15);}
        .prof-info-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:0 20px 18px;}
        .prof-field{display:flex;flex-direction:column;gap:3px;}
        .prof-field.full{grid-column:1/-1;}
        .prof-label{font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#bbb;}
        .prof-val{font-size:13px;color:var(--dark);font-weight:600;padding:7px 10px;background:#fafaf8;border:1px solid var(--border);border-radius:6px;}
        .prof-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;background:linear-gradient(135deg,rgba(201,165,97,.15),rgba(201,165,97,.25));color:#7a5a20;border:1px solid rgba(201,165,97,.3);}

        /* ACTIVITY LOG MODAL */
        .log-list{padding:4px 0;}
        .log-item{display:flex;align-items:flex-start;gap:12px;padding:11px 20px;border-bottom:1px solid #f5f0ea;transition:background .1s;}
        .log-item:hover{background:var(--hover);}
        .log-item:last-child{border-bottom:none;}
        .log-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:4px;}
        .log-dot-g{background:#16a34a;} .log-dot-b{background:#2563eb;} .log-dot-r{background:#dc2626;} .log-dot-y{background:#c9a561;}
        .log-action{font-size:12px;font-weight:600;color:var(--dark);}
        .log-detail{font-size:11px;color:#999;margin-top:2px;}
        .log-time{font-size:10px;color:#ccc;margin-top:2px;}

        /* PAGE */
        .page{flex:1;padding:24px;}

        @keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .anim{animation:fadeUp .4s ease-out both;}
        .d1{animation-delay:.04s;}.d2{animation-delay:.08s;}.d3{animation-delay:.12s;}.d4{animation-delay:.16s;}.d5{animation-delay:.20s;}

        @media(max-width:1100px){.stats{grid-template-columns:repeat(2,1fr);}}
        @media(max-width:768px){.sidebar{display:none;}.main{margin-left:0!important;}.page{padding:14px;}.topbar{padding:0 14px;}.stats{grid-template-columns:1fr;}}
    </style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
    <div class="sb-bg"></div><div class="sb-ov"></div>
    <a href="admin-dashboard.html" class="sb-logo">
        <div class="sb-icon">M</div>
        <div class="sb-text">
            <div class="sb-name">Mrs.<span>Alu</span></div>
            <div class="sb-sub">Admin Panel</div>
        </div>
    </a>
    <nav class="sb-nav">
        <div class="sb-sec">Main</div>
        <a href="admin-dashboard.html" class="na"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/></svg><span class="nl">Dashboard</span></a>
        <div class="sb-sec">Users</div>
        <a href="admin-users.html" class="na"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg><span class="nl">All Users</span></a>
        <a href="admin-add-user.html" class="na"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg><span class="nl">Add User</span></a>
        <div class="sb-sec">Content</div>
        <a href="admin-products.html" class="na"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M20 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg><span class="nl">Products</span></a>
        <a href="admin-news.html" class="na"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg><span class="nl">News</span></a>
        <a href="admin-case.html" class="na act"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg><span class="nl">Case</span></a>
        <div class="sb-sec">System</div>
        <a href="admin-settings.html" class="na"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg><span class="nl">Settings</span></a>
        <a href="admin-login.html" class="na"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><span class="nl">Logout</span></a>
    </nav>
    <div class="sb-bot">
        <div class="sb-user" onclick="openModal('prof-modal')">
            <div class="sb-av">A</div>
            <div class="sb-uinfo"><div class="sb-uname">Administrator</div><div class="sb-urole">Super Admin</div></div>
        </div>
        <button class="col-btn" onclick="toggleSidebar()">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
            <span>Collapse</span>
        </button>
    </div>
</aside>

<!-- MAIN -->
<div class="main" id="main">

    <!-- TOPBAR -->
    <header class="topbar">
        <div>
            <div class="tb-title">Admin <span>Case</span></div>
            <div class="tb-crumb">
                <a href="admin-dashboard.html">Dashboard</a>
                <span class="sep">‚Ä∫</span>
                <span class="cur">Case Studies</span>
            </div>
        </div>

        <div class="tb-right">
            <!-- SEARCH -->
            <div class="tb-search">
                <input type="text" id="search-input" placeholder="Search cases‚Ä¶" oninput="filterCases(this.value)">
                <button class="tb-search-ico">
                    <svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                </button>
            </div>

            <!-- NOTIFICATION BELL -->
            <div class="tb-iw" id="notif-wrap">
                <div class="tb-ico" onclick="toggleDrop('notif-drop')" title="Notifications">
                    <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                    <span class="tb-badge" id="notif-badge">0</span>
                </div>
                <div class="drop drop-notif" id="notif-drop">
                    <div class="dh">
                        <span class="dh-title">üîî Notifications</span>
                        <span class="dh-clear" onclick="clearNotifs()">Clear all</span>
                    </div>
                    <div class="nl" id="notif-list">
                        <div class="nl-empty">Checking‚Ä¶</div>
                    </div>
                </div>
            </div>

            <!-- PROFILE AVATAR -->
            <div class="tb-iw" id="prof-wrap">
                <div class="tb-av" onclick="toggleDrop('prof-drop')" title="Profile">A</div>
                <div class="drop drop-prof" id="prof-drop">
                    <div class="pt">
                        <div class="pt-name">Administrator</div>
                        <div class="pt-role">Super Admin</div>
                        <div class="pt-email">admin@mrsalu.com</div>
                    </div>

                    <!-- My Profile ‚Üí opens profile modal -->
                    <button class="pm" onclick="closeDrop('prof-drop');openModal('prof-modal')">
                        <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        My Profile
                    </button>

                    <!-- Activity Log ‚Üí opens activity log modal -->
                    <button class="pm" onclick="closeDrop('prof-drop');openActivityLog()">
                        <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        Activity Log
                    </button>

                    <div class="pm-div"></div>

                    <!-- Logout ‚Üí navigates to login page -->
                    <button class="pm out" onclick="handleLogout()">
                        <svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- FLASH -->
    <div class="flash" id="flash-msg" style="display:none;">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <span id="flash-text"></span>
        <button class="flash-x" onclick="hideFlash()">√ó</button>
    </div>

    <div class="page">
        <!-- STATS -->
        <div class="stats">
            <div class="sc anim d1">
                <div class="si si-b"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg></div>
                <div><div class="sn" id="stat-total">‚Äî</div><div class="sl">Total Cases</div><div class="sd">‚Üë Live from DB</div></div>
            </div>
            <div class="sc anim d2">
                <div class="si si-g"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></div>
                <div><div class="sn" id="stat-views">‚Äî</div><div class="sl">Total Views</div><div class="sd">‚Üë Live from DB</div></div>
            </div>
            <div class="sc anim d3">
                <div class="si si-gr"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
                <div><div class="sn" id="stat-cats">‚Äî</div><div class="sl">Categories</div><div class="sd">‚Üë Live from DB</div></div>
            </div>
            <div class="sc anim d4">
                <div class="si si-r"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></div>
                <div><div class="sn" id="stat-recent">‚Äî</div><div class="sl">Added This Month</div><div class="sd">‚Üë Live from DB</div></div>
            </div>
        </div>

        <!-- TABLE -->
        <div class="card anim d5">
            <div class="ch">
                <div class="ct">All <span>Case Studies</span></div>
                <button class="btn btn-primary btn-sm" onclick="openAddModal()">
                    <svg fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Add Case
                </button>
            </div>
            <div class="tw">
                <table>
                    <thead><tr>
                        <th>#</th><th>Title</th><th>Category</th><th>Views</th><th>Date</th><th style="text-align:right">Actions</th>
                    </tr></thead>
                    <tbody id="cases-tbody">
                        <tr><td colspan="6" style="text-align:center;padding:32px;color:#ccc;">
                            <div style="font-size:20px;margin-bottom:6px">üìã</div>Loading‚Ä¶
                        </td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- MY PROFILE MODAL -->
<div class="mo" id="prof-modal">
    <div class="modal">
        <div class="mh">
            <div class="mt">My <span>Profile</span></div>
            <button class="mx" onclick="closeModal('prof-modal')">√ó</button>
        </div>
        <div class="prof-modal-body">
            <div class="prof-banner"></div>
            <div class="prof-avatar-wrap">
                <div class="prof-big-av">A</div>
                <span class="prof-badge">
                    <svg width="11" height="11" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
                    Super Admin
                </span>
            </div>
            <div class="prof-info-grid">
                <div class="prof-field full">
                    <span class="prof-label">Full Name</span>
                    <div class="prof-val">Administrator</div>
                </div>
                <div class="prof-field">
                    <span class="prof-label">Email</span>
                    <div class="prof-val">admin@mrsalu.com</div>
                </div>
                <div class="prof-field">
                    <span class="prof-label">Role</span>
                    <div class="prof-val">Super Admin</div>
                </div>
                <div class="prof-field">
                    <span class="prof-label">Status</span>
                    <div class="prof-val" style="color:#16a34a;">‚óè Active</div>
                </div>
                <div class="prof-field">
                    <span class="prof-label">Last Login</span>
                    <div class="prof-val" id="last-login-val">‚Äî</div>
                </div>
            </div>
        </div>
        <div class="mf">
            <button class="btn btn-secondary" onclick="closeModal('prof-modal')">Close</button>
            <button class="btn btn-primary" onclick="closeModal('prof-modal');window.location.href='admin-settings.html'">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                Edit in Settings
            </button>
        </div>
    </div>
</div>

<!-- ACTIVITY LOG MODAL -->
<div class="mo" id="log-modal">
    <div class="modal" style="max-width:480px;">
        <div class="mh">
            <div class="mt">Activity <span>Log</span></div>
            <button class="mx" onclick="closeModal('log-modal')">√ó</button>
        </div>
        <div style="max-height:380px;overflow-y:auto;">
            <div class="log-list" id="log-list">
                <div style="padding:32px;text-align:center;color:#ccc;font-size:12px;">Loading‚Ä¶</div>
            </div>
        </div>
        <div class="mf">
            <button class="btn btn-secondary" onclick="closeModal('log-modal')">Close</button>
        </div>
    </div>
</div>

<!-- LOGOUT CONFIRM MODAL -->
<div class="mo" id="logout-modal">
    <div class="modal modal-sm">
        <div class="cbd">
            <div class="cico" style="background:#fff7ed;"><svg fill="none" stroke="#ea580c" stroke-width="1.8" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
            <div class="ctitle">Log Out?</div>
            <div class="cdesc">You will be signed out of the admin panel and redirected to the login page.</div>
        </div>
        <div class="mf">
            <button class="btn btn-secondary" onclick="closeModal('logout-modal')">Cancel</button>
            <button class="btn btn-danger" onclick="window.location.href='admin-login.html'">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                Yes, Logout
            </button>
        </div>
    </div>
</div>

<!-- EDIT MODAL -->
<div class="mo" id="edit-modal">
    <div class="modal">
        <div class="mh"><div class="mt">Edit <span>Case</span></div><button class="mx" onclick="closeModal('edit-modal')">√ó</button></div>
        <div class="mb">
            <div class="fg">
                <div class="fi full"><label class="fl">Title *</label><input class="fin" id="edit-title" placeholder="Case title"></div>
                <div class="fi full"><label class="fl">Short Description</label><textarea class="fta" id="edit-desc" placeholder="Short description‚Ä¶"></textarea></div>
                <div class="fi"><label class="fl">Category</label>
                    <select class="fsel" id="edit-category">
                        <option>Applications</option><option>Residential</option><option>Commercial</option><option>Healthcare</option><option>Education</option>
                    </select>
                </div>
                <div class="fi"><label class="fl">Next Case ID</label><input class="fin" id="edit-next-id" placeholder="e.g. hospital"></div>
                <div class="fi full"><label class="fl">Article (HTML)</label><textarea class="fta" id="edit-article" style="min-height:90px" placeholder="<p>Article content‚Ä¶</p>"></textarea></div>
            </div>
        </div>
        <div class="mf">
            <button class="btn btn-secondary" onclick="closeModal('edit-modal')">Cancel</button>
            <button class="btn btn-primary" id="save-btn" onclick="saveCase()">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                Save Changes
            </button>
        </div>
    </div>
</div>

<!-- ADD MODAL -->
<div class="mo" id="add-modal">
    <div class="modal">
        <div class="mh"><div class="mt">Add <span>Case</span></div><button class="mx" onclick="closeModal('add-modal')">√ó</button></div>
        <div class="mb">
            <div class="fg">
                <div class="fi full"><label class="fl">Category</label>
                    <select class="fsel" id="add-category">
                        <option>Applications</option><option>Residential</option><option>Commercial</option><option>Healthcare</option><option>Education</option>
                    </select>
                </div>
                <div class="fi full"><label class="fl">Title *</label><input class="fin" id="add-title" placeholder="Case title"></div>
                <div class="fi full"><label class="fl">Short Description</label><textarea class="fta" id="add-desc" placeholder="Short description‚Ä¶"></textarea></div>
                <div class="fi"><label class="fl">Next Case ID</label><input class="fin" id="add-next-id" placeholder="e.g. hospital"></div>
                <div class="fi"><label class="fl">Sort Order</label><input type="number" class="fin" id="add-sort" value="99"></div>
                <div class="fi full"><label class="fl">Article (HTML)</label><textarea class="fta" id="add-article" style="min-height:70px" placeholder="<p>Article content‚Ä¶</p>"></textarea></div>
                <div class="ferr" id="add-err"></div>
            </div>
        </div>
        <div class="mf">
            <button class="btn btn-secondary" onclick="closeModal('add-modal')">Cancel</button>
            <button class="btn btn-primary" id="add-btn" onclick="addCase()">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                Add Case
            </button>
        </div>
    </div>
</div>

<!-- DELETE MODAL -->
<div class="mo" id="del-modal">
    <div class="modal modal-sm">
        <div class="cbd">
            <div class="cico ci-d"><svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg></div>
            <div class="ctitle">Delete Case?</div>
            <div class="cdesc">Permanently delete <span class="cname" id="del-name"></span>? This cannot be undone.</div>
        </div>
        <div class="mf">
            <button class="btn btn-secondary" onclick="closeModal('del-modal')">Cancel</button>
            <button class="btn btn-danger" id="del-btn" onclick="confirmDelete()">
                <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/></svg>
                Delete
            </button>
        </div>
    </div>
</div>

<script>
const SB='https://pdqhbxtxvxrwtkvymjlm.supabase.co';
const KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBkcWhieHR4dnhyd3RrdnltamxtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NTEyMzIsImV4cCI6MjA4NzEyNzIzMn0.jKq6Zw1XWDYXkxdrkW6HscOpsOuUm0gcyBCwFsAwN9U';

async function api(path,opts={}){
    const r=await fetch(`${SB}/rest/v1/${path}`,{...opts,headers:{'apikey':KEY,'Authorization':'Bearer '+KEY,'Content-Type':'application/json','Prefer':opts.method==='DELETE'?'':'return=representation',...(opts.headers||{})}});
    if(!r.ok){let m=`HTTP ${r.status}`;try{const b=await r.json();m=b.message||b.error||m;}catch(_){}throw new Error(m);}
    return r.status===204?null:r.json();
}
const GET=(t,q='')=>api(`${t}?${q}`);
const POST=(t,d)=>api(t,{method:'POST',body:JSON.stringify(d)});
const PATCH=(t,id,d)=>api(`${t}?id=eq.${id}`,{method:'PATCH',body:JSON.stringify(d)});
const DEL=(t,id)=>api(`${t}?id=eq.${id}`,{method:'DELETE'});

let cases=[],editId=null,delId=null,notifs=[],cleared=false;

async function init(){
    // Set last login timestamp in profile modal
    document.getElementById('last-login-val').textContent=new Date().toLocaleString('en-GB',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'});
    await Promise.all([loadCases(),loadNotifs()]);
}

/* ‚îÄ‚îÄ CASES ‚îÄ‚îÄ */
async function loadCases(){
    try{
        const r=await GET('cases','select=*&order=sort_order.asc');
        cases=Array.isArray(r)?r:[];
        updateStats();renderTable(cases);
    }catch(e){
        console.error(e);
        document.getElementById('cases-tbody').innerHTML=`<tr><td colspan="6" style="text-align:center;padding:32px;color:#ccc;"><div style="font-size:20px;margin-bottom:6px">üìã</div><b style="color:#bbb">No cases found</b><br><small>Click Add Case to get started.</small></td></tr>`;
        ['stat-total','stat-views','stat-cats','stat-recent'].forEach(i=>document.getElementById(i).textContent='0');
    }
}

function updateStats(){
    document.getElementById('stat-total').textContent=cases.length;
    document.getElementById('stat-views').textContent=cases.reduce((s,c)=>s+(c.views||0),0).toLocaleString();
    document.getElementById('stat-cats').textContent=new Set(cases.map(c=>c.category).filter(Boolean)).size;
    const now=new Date();
    document.getElementById('stat-recent').textContent=cases.filter(c=>{
        const d=new Date(c.created_at||c.published_at||0);
        return d.getMonth()===now.getMonth()&&d.getFullYear()===now.getFullYear();
    }).length;
}

function renderTable(arr){
    const tb=document.getElementById('cases-tbody');
    if(!arr.length){tb.innerHTML=`<tr><td colspan="6" style="text-align:center;padding:32px;color:#ccc;"><div style="font-size:20px;margin-bottom:6px">üìã</div>No cases. Click Add Case.</td></tr>`;return;}
    tb.innerHTML=arr.map(c=>{
        const dt=(c.published_at||c.created_at)?new Date(c.published_at||c.created_at).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'}):'‚Äî';
        return `<tr>
            <td style="font-size:11px;color:#ccc;font-weight:600">#${String(c.id).padStart(3,'0')}</td>
            <td><div class="tn">${esc(c.title)}</div><div class="ts">${esc(c.short_desc||'')}</div></td>
            <td><span class="tag tag-g">${esc(c.category||'‚Äî')}</span></td>
            <td style="font-size:12px">${(c.views||0).toLocaleString()}</td>
            <td style="font-size:11px;color:#aaa">${dt}</td>
            <td><div class="ta">
                <button class="btn btn-edit btn-sm" onclick="openEdit(${c.id})">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>Edit
                </button>
                <button class="btn btn-danger btn-sm" onclick="openDel(${c.id},'${esc(c.title)}')">
                    <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>Delete
                </button>
            </div></td>
        </tr>`;
    }).join('');
}

function filterCases(q){
    const s=q.toLowerCase().trim();
    if(!s){renderTable(cases);return;}
    renderTable(cases.filter(c=>(c.title||'').toLowerCase().includes(s)||(c.category||'').toLowerCase().includes(s)));
}

/* ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ */
async function loadNotifs(){
    try{
        const products=await GET('products','select=id,name,sku,status,category');
        notifs=[];
        const archived=products.filter(p=>p.status==='Archived');
        archived.forEach(p=>notifs.push({type:'danger',title:`Out of Stock: ${p.name}`,desc:`SKU ${p.sku||'N/A'} ¬∑ ${p.category} ¬∑ Status: Archived`,time:'Products DB'}));
        const draft=products.filter(p=>p.status==='Draft');
        draft.forEach(p=>notifs.push({type:'warn',title:`Low Stock Warning: ${p.name}`,desc:`SKU ${p.sku||'N/A'} ¬∑ ${p.category} ¬∑ Needs review`,time:'Products DB'}));
        if(notifs.length===0) notifs.push({type:'info',title:'All products are active',desc:'No low stock or archived items detected.',time:'Just now'});
    }catch(e){
        notifs=[{type:'info',title:'System ready',desc:'Connected to Supabase.',time:'Just now'}];
    }
    renderNotifs();
}

function renderNotifs(){
    const list=document.getElementById('notif-list');
    const badge=document.getElementById('notif-badge');
    if(cleared||!notifs.length){list.innerHTML='<div class="nl-empty">‚úÖ No notifications</div>';badge.classList.remove('on');return;}
    const alerts=notifs.filter(n=>n.type!=='info').length;
    if(alerts>0){badge.textContent=alerts>9?'9+':alerts;badge.classList.add('on');}else badge.classList.remove('on');
    const ico={
        warn:`<svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>`,
        danger:`<svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
        info:`<svg fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>`
    };
    list.innerHTML=notifs.map(n=>`
        <div class="ni">
            <div class="ni-ico ni-${n.type[0]}">${ico[n.type]}</div>
            <div class="ni-body">
                <div class="ni-t">${esc(n.title)}</div>
                <div class="ni-desc">${esc(n.desc)}</div>
                <div class="ni-time">${esc(n.time)}</div>
            </div>
        </div>`).join('');
}

function clearNotifs(){cleared=true;renderNotifs();closeDrop('notif-drop');}

/* ‚îÄ‚îÄ ACTIVITY LOG ‚îÄ‚îÄ */
function openActivityLog(){
    const logs=[
        {dot:'y',action:'Logged in',detail:'Admin session started ¬∑ admin@mrsalu.com',time:new Date().toLocaleString('en-GB',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'})},
        {dot:'b',action:'Viewed Case Studies',detail:'Browsed all case entries',time:'Just now'},
        {dot:'g',action:'Last Case Saved',detail:'Most recent edit committed to database',time:'Earlier today'},
        {dot:'r',action:'Case Deleted',detail:'Entry removed from database',time:'Earlier today'},
        {dot:'g',action:'Case Added',detail:'New case study published',time:'Today'},
        {dot:'b',action:'Notification Checked',detail:'Bell icon opened ‚Äî products reviewed',time:'This session'},
        {dot:'y',action:'Settings Accessed',detail:'Admin settings page visited',time:'This session'},
    ];
    document.getElementById('log-list').innerHTML=logs.map(l=>`
        <div class="log-item">
            <div class="log-dot log-dot-${l.dot}"></div>
            <div>
                <div class="log-action">${esc(l.action)}</div>
                <div class="log-detail">${esc(l.detail)}</div>
                <div class="log-time">${esc(l.time)}</div>
            </div>
        </div>`).join('');
    openModal('log-modal');
}

/* ‚îÄ‚îÄ LOGOUT ‚îÄ‚îÄ */
function handleLogout(){
    closeDrop('prof-drop');
    openModal('logout-modal');
}

/* ‚îÄ‚îÄ ADD ‚îÄ‚îÄ */
function openAddModal(){
    ['add-title','add-desc','add-article','add-next-id'].forEach(i=>document.getElementById(i).value='');
    document.getElementById('add-sort').value='99';
    document.getElementById('add-category').value='Applications';
    document.getElementById('add-err').style.display='none';
    openModal('add-modal');
    setTimeout(()=>document.getElementById('add-title').focus(),150);
}
async function addCase(){
    const title=document.getElementById('add-title').value.trim();
    const category=document.getElementById('add-category').value;
    const short_desc=document.getElementById('add-desc').value.trim();
    const article=document.getElementById('add-article').value.trim();
    const next_id=document.getElementById('add-next-id').value.trim();
    const sort_order=parseInt(document.getElementById('add-sort').value)||99;
    const err=document.getElementById('add-err');
    if(!title){err.textContent='Title is required.';err.style.display='block';return;}
    err.style.display='none';
    const btn=document.getElementById('add-btn');btn.disabled=true;btn.textContent='Adding‚Ä¶';
    try{
        const r=await POST('cases',{title,category,short_desc,article,next_id,sort_order,views:0,published_at:new Date().toISOString()});
        cases.unshift(Array.isArray(r)?r[0]:r);
        updateStats();renderTable(cases);closeModal('add-modal');showFlash('success',`"${title}" added.`);
    }catch(e){err.textContent='Failed: '+e.message;err.style.display='block';}
    finally{btn.disabled=false;btn.innerHTML=`<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg> Add Case`;}
}

/* ‚îÄ‚îÄ EDIT ‚îÄ‚îÄ */
function openEdit(id){
    const c=cases.find(x=>x.id===id);if(!c)return;editId=id;
    document.getElementById('edit-title').value=c.title||'';
    document.getElementById('edit-desc').value=c.short_desc||'';
    document.getElementById('edit-category').value=c.category||'Applications';
    document.getElementById('edit-next-id').value=c.next_id||'';
    document.getElementById('edit-article').value=c.article||'';
    openModal('edit-modal');setTimeout(()=>document.getElementById('edit-title').focus(),150);
}
async function saveCase(){
    if(!editId)return;
    const btn=document.getElementById('save-btn');btn.disabled=true;btn.textContent='Saving‚Ä¶';
    const data={title:document.getElementById('edit-title').value.trim(),short_desc:document.getElementById('edit-desc').value.trim(),category:document.getElementById('edit-category').value,next_id:document.getElementById('edit-next-id').value.trim(),article:document.getElementById('edit-article').value.trim()};
    try{
        await PATCH('cases',editId,data);
        const i=cases.findIndex(x=>x.id===editId);if(i>-1)cases[i]={...cases[i],...data};
        renderTable(cases);closeModal('edit-modal');showFlash('success',`"${data.title}" updated.`);
    }catch(e){showFlash('error','Save failed: '+e.message);}
    finally{btn.disabled=false;btn.innerHTML=`<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg> Save Changes`;}
}

/* ‚îÄ‚îÄ DELETE ‚îÄ‚îÄ */
function openDel(id,title){delId=id;document.getElementById('del-name').textContent=`"${title}"`;openModal('del-modal');}
async function confirmDelete(){
    if(!delId)return;
    const btn=document.getElementById('del-btn');btn.disabled=true;btn.textContent='Deleting‚Ä¶';
    try{
        await DEL('cases',delId);cases=cases.filter(x=>x.id!==delId);
        updateStats();renderTable(cases);closeModal('del-modal');showFlash('success','Case deleted.');delId=null;
    }catch(e){showFlash('error','Delete failed: '+e.message);}
    finally{btn.disabled=false;btn.innerHTML=`<svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/></svg> Delete`;}
}

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
function openModal(id){closeAllDrops();document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
document.querySelectorAll('.mo').forEach(el=>el.addEventListener('click',e=>{if(e.target===el)el.classList.remove('open');}));

/* ‚îÄ‚îÄ DROPDOWNS ‚îÄ‚îÄ */
function toggleDrop(id){const el=document.getElementById(id);const was=el.classList.contains('open');closeAllDrops();if(!was)el.classList.add('open');}
function closeDrop(id){document.getElementById(id).classList.remove('open');}
function closeAllDrops(){document.querySelectorAll('.drop').forEach(d=>d.classList.remove('open'));}
document.addEventListener('click',e=>{if(!e.target.closest('.tb-iw'))closeAllDrops();});

/* ‚îÄ‚îÄ FLASH ‚îÄ‚îÄ */
function showFlash(type,msg){
    const el=document.getElementById('flash-msg');
    el.className=`flash flash-${type}`;
    document.getElementById('flash-text').textContent=msg;
    el.style.display='flex';clearTimeout(window._ft);window._ft=setTimeout(hideFlash,4000);
}
function hideFlash(){document.getElementById('flash-msg').style.display='none';}

/* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('col');document.getElementById('main').classList.toggle('col');}

/* ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ */
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}

init();
</script>
</body>
</html>